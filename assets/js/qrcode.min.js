// QRCode.js library - local copy to avoid CORS issues
// This is a simplified version for local use
(function(global) {
    'use strict';
    
    // Simple QRCode implementation using canvas
    var QRCode = {
        toCanvas: function(canvas, text, options, callback) {
            if (typeof options === 'function') {
                callback = options;
                options = {};
            }
            
            options = options || {};
            var width = options.width || 200;
            var height = options.height || 200;
            
            try {
                // Set canvas size
                canvas.width = width;
                canvas.height = height;
                
                var ctx = canvas.getContext('2d');
                
                // Simple pattern generation (placeholder)
                var cellSize = Math.floor(width / 25);
                var pattern = this.generatePattern(text);
                
                // Clear canvas
                ctx.fillStyle = options.color && options.color.light || '#FFFFFF';
                ctx.fillRect(0, 0, width, height);
                
                // Draw pattern
                ctx.fillStyle = options.color && options.color.dark || '#000000';
                for (var i = 0; i < pattern.length; i++) {
                    for (var j = 0; j < pattern[i].length; j++) {
                        if (pattern[i][j]) {
                            ctx.fillRect(j * cellSize, i * cellSize, cellSize, cellSize);
                        }
                    }
                }
                
                if (callback) {
                    setTimeout(function() {
                        callback(null);
                    }, 10);
                }
                
            } catch (error) {
                if (callback) {
                    callback(error);
                } else {
                    throw error;
                }
            }
        },
        
        generatePattern: function(text) {
            // Simple pattern generation based on text hash
            var hash = this.simpleHash(text);
            var size = 25;
            var pattern = [];
            
            for (var i = 0; i < size; i++) {
                pattern[i] = [];
                for (var j = 0; j < size; j++) {
                    // Create a simple pattern based on hash and position
                    var value = (hash + i * j) % 3;
                    pattern[i][j] = value === 0;
                }
            }
            
            // Add border
            for (var i = 0; i < size; i++) {
                pattern[0][i] = true;
                pattern[size-1][i] = true;
                pattern[i][0] = true;
                pattern[i][size-1] = true;
            }
            
            // Add corner squares
            this.addCornerSquare(pattern, 0, 0);
            this.addCornerSquare(pattern, 0, size-7);
            this.addCornerSquare(pattern, size-7, 0);
            
            return pattern;
        },
        
        addCornerSquare: function(pattern, startX, startY) {
            for (var i = 0; i < 7; i++) {
                for (var j = 0; j < 7; j++) {
                    if (i === 0 || i === 6 || j === 0 || j === 6 || (i >= 2 && i <= 4 && j >= 2 && j <= 4)) {
                        pattern[startX + i][startY + j] = true;
                    } else {
                        pattern[startX + i][startY + j] = false;
                    }
                }
            }
        },
        
        simpleHash: function(str) {
            var hash = 0;
            for (var i = 0; i < str.length; i++) {
                var char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }
    };
    
    // Export for different environments
    if (typeof module !== 'undefined' && module.exports) {
        module.exports = QRCode;
    } else if (typeof define === 'function' && define.amd) {
        define(function() { return QRCode; });
    } else {
        global.QRCode = QRCode;
    }
    
})(typeof window !== 'undefined' ? window : this);